<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Micropython in Jupyter Notebooks | fastpages</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Micropython in Jupyter Notebooks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Configuring a Development Environment for microcontrollers in Jupyter" />
<meta property="og:description" content="Configuring a Development Environment for microcontrollers in Jupyter" />
<link rel="canonical" href="https://qwertimer.github.io/qwertimers_blog/jupyter/microcontrollers/micropython/circuitpython/2021/03/08/Creating-a-jupyter-dev-pipeline-for-microcontrollers.html" />
<meta property="og:url" content="https://qwertimer.github.io/qwertimers_blog/jupyter/microcontrollers/micropython/circuitpython/2021/03/08/Creating-a-jupyter-dev-pipeline-for-microcontrollers.html" />
<meta property="og:site_name" content="fastpages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-08T00:00:00-06:00" />
<script type="application/ld+json">
{"url":"https://qwertimer.github.io/qwertimers_blog/jupyter/microcontrollers/micropython/circuitpython/2021/03/08/Creating-a-jupyter-dev-pipeline-for-microcontrollers.html","@type":"BlogPosting","headline":"Micropython in Jupyter Notebooks","dateModified":"2021-03-08T00:00:00-06:00","datePublished":"2021-03-08T00:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://qwertimer.github.io/qwertimers_blog/jupyter/microcontrollers/micropython/circuitpython/2021/03/08/Creating-a-jupyter-dev-pipeline-for-microcontrollers.html"},"description":"Configuring a Development Environment for microcontrollers in Jupyter","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/qwertimers_blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://qwertimer.github.io/qwertimers_blog/feed.xml" title="fastpages" /><link rel="shortcut icon" type="image/x-icon" href="/qwertimers_blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/qwertimers_blog/">fastpages</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/qwertimers_blog/about/">About Me</a><a class="page-link" href="/qwertimers_blog/search/">Search</a><a class="page-link" href="/qwertimers_blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Micropython in Jupyter Notebooks</h1><p class="page-description">Configuring a Development Environment for microcontrollers in Jupyter</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-03-08T00:00:00-06:00" itemprop="datePublished">
        Mar 8, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/qwertimers_blog/categories/#Jupyter">Jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/qwertimers_blog/categories/#Microcontrollers">Microcontrollers</a>
        &nbsp;
      
        <a class="category-tags-link" href="/qwertimers_blog/categories/#Micropython">Micropython</a>
        &nbsp;
      
        <a class="category-tags-link" href="/qwertimers_blog/categories/#CircuitPython">CircuitPython</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#building-a-development-environment-in-jupyter-for-microcontrollers">Building a Development environment in jupyter for microcontrollers.</a></li>
</ul><h1 id="building-a-development-environment-in-jupyter-for-microcontrollers">
<a class="anchor" href="#building-a-development-environment-in-jupyter-for-microcontrollers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building a Development environment in jupyter for microcontrollers.</h1>

<p>The goal of this development was to build a pipeline to implement nbdev based code development with circuitpython. The initial issue that i faced was that the circuitpython jupyter kernel captured every message sent to jupyter and forwarded this over serial to the mcu. I had to capture this data before it was sent to be able to use it in python. I didn’t want to effect the overall functionality of the circuitptyhon kernel so i chose to replicate the %python and %%python magics with one key difference. These magics did not create a subprocess by calling a command line based python. These parsed the python code to eval and exec commands. Below is the code written to implement the line magic %python. Currently the system has two flaws that need to be fixed the first of these is that the output of the commands implemented into the jupyter notebook do not display to the system. The second thing of note is that the system does not include a global scope for this information and as such the information isn’t passed between cells. Further work aims to undertake this and help to catch some of the other errors that occur when running the code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> def is_magic(self, line):
        """Returns true if line was handled"""
        if line.startswith("%softreset"):
            self.board.softreset()
        elif line.startswith("%upload_delay"):
            try:
                s_line = line.split(' ')
                self.upload_delay = float(s_line[1])
                KERNEL_LOGGER.debug(f"upload_delay set to {float(s_line[1])} s")
            except TypeError:
                pass
        elif line.startswith("%python"):
            #python line magic, runs what ever is on the line following the %python magic.
            code = line.lstrip("%python")
            code = code.lstrip(' ')
            for item in code.split(";"):
                item = item.lstrip(' ') #remove leading white space
                try:
                    print(eval(item))   #does not print
                except:
                    out = exec(item)
                    if out != None:
                        print(out)      #does not print
            
        else:
            return False
        return True
</code></pre></div></div>

<p>The cell magics code is shown below. If you wish to play with this library feel free to install my fork of the adafruit circuitpython jupyter kernel from this link (https://github.com/qwertimer/circuitpython_jupyter_kernel) or if my pull request is accepted the latest versions of the adafruit library.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 def is_cell_magic(self, code):
        """Cell magic to run python code.
        -----
        Cell shall begin with %%python followed by a new line
        Will iteratively run each line of code.
        """

        if code.startswith("%%python"):
            code = code.lstrip("%%python")
            code = code.lstrip(' ')
            data = code.splitlines(True)
            for item in data:
                
                code = code.lstrip(' ')    #this removes all preceeding white space, 
                                           #i need to figure out how to get for loops, etc working
                try:
                    print(eval(item))      #does not print
                except:
                    out = exec(item)

                    if out != None:
                        print(out)         #does not print
            return True
        else:
            return False
</code></pre></div></div>

<p>Finally, this is a work in progress and further magics may be implemented to run makefiles and other CI based tests in the jupyter notebook. One day this system will be a fully fledged repl and development environment for circuitpython.</p>


  </div><a class="u-url" href="/qwertimers_blog/jupyter/microcontrollers/micropython/circuitpython/2021/03/08/Creating-a-jupyter-dev-pipeline-for-microcontrollers.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/qwertimers_blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/qwertimers_blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/qwertimers_blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>An easy to use blogging platform with support for Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/fastai" title="fastai"><svg class="svg-icon grey"><use xlink:href="/qwertimers_blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/fastdotai" title="fastdotai"><svg class="svg-icon grey"><use xlink:href="/qwertimers_blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
